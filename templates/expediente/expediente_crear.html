{% extends 'core/index.html' %}
{% load widget_tweaks %}
{% load static %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static '/css/forms.css' %}" />
{% endblock extra_head %} 

{% block body %}
{% if form.non_field_errors %}
<div class="alert alert-danger">
    {% for error in form.non_field_errors %}
        <p>{{ error }}</p>
    {% endfor %}
</div>
{% endif %}

<div class="container-fluid">
    <div class="container mt-4">
        <div class="card px-2 shadow-lg rounded col-md-12 mx-auto">
            <!-- Encabezado -->
            <div class="card-header text-center">
                <h5 class="mb-0">
                    {% if editar %}EDITAR EXPEDIENTE{% else %}NUEVO EXPEDIENTE{% endif %}
                    <span id="medioIngresoTexto">{{ form.initial.medio_ingreso }}</span>
                </h5>
            </div>
            <!-- Formulario -->       
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <!-- Encabezado -->
                <div class="card  mt-3 mb-3 border-0 shadow-md">
                    <div class="card-body">
                        <h6 class="border-bottom pb-2 mb-3 text-muted">
                            <div class="d-flex justify-content-between">
                                <span>Encabezado</span>
                                {% if editar and numero_expediente %}
                                    <span class="fw-bold">{{ numero_expediente }}</span>
                                {% endif %}
                            </div>
                        </h6>
                        <div class="row">
                            <div class="mb-3 col-md-3">
                                {{ form.sede.label_tag }}
                                {{ form.sede|add_class:"form-select" }}
                                {% if form.sede.errors %}
                                    <div class="text-danger small">
                                        {{ form.sede.errors }}
                                    </div>
                                {% endif %}
                            </div>
                            <div class="mb-3 col-md-3">
                                {{ form.medio_ingreso.label_tag }}
                                {{ form.medio_ingreso|add_class:"form-select" }}
                                {% if form.medio_ingreso.errors %}
                                    <div class="text-danger small">
                                        {{ form.medio_ingreso.errors }}
                                    </div>
                                {% endif %}
                            </div>
                            <div class="mb-3 col-md-3">
                                <label for="rol">Rol</label>
                                <select name="rol" id="rol" class="form-select">
                                    <option value="">Seleccione un rol</option>
                                    {% for rol in roles %}
                                        <option value="{{ rol.id }}">{{ rol }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="mb-3 col-md-3">
                                {{ form.fecha_creacion.label_tag }}
                                {% render_field form.fecha_creacion type="date" class="form-control" %}
                                {% if form.fecha_creacion.errors %}
                                    <div class="text-danger small">
                                        {{ form.fecha_creacion.errors }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="row">
                            <div class="mb-3 col-md-6">
                                <label for="persona">Persona</label>
                                <select name="persona" id="persona" class="form-select">
                                    <option value="">Seleccione una persona</option>
                                    {% for persona in personas %}
                                        <option value="{{ persona.id }}">{{ persona }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="mb-3 col-md-2">
                                {{ form.edad_persona.label_tag }}
                                {% render_field form.edad_persona class="form-control" %}
                            </div>
                            <div class="mb-3 col-md-4">
                                {{ form.grupo_etario.label_tag }}
                                {% render_field form.grupo_etario class="form-control" %}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mb-3 border-0 shadow-sm">
                    <div class="card-body">
                        <h6 class="border-bottom pb-2 mb-3 text-muted">
                            <span>Informaci√≥n Adicional</span>
                        </h6>
                        <div class="row">
                            <div class="mb-3 col-md-4">
                                {{ form.tipo_solicitud.label_tag }}
                                {% render_field form.tipo_solicitud class="form-control" %}
                            </div>
                            <div class="mb-3 col-md-4">
                                {{ form.estado_expediente.label_tag }}
                                {% render_field form.estado_expediente class="form-control" %}
                            </div>
                            <div class="mb-3 col-md-4">
                                {{ form.resumen_intervencion.label_tag }}
                                {% render_field form.resumen_intervencion class="form-control" %}
                            </div>
                        </div>
                        <div class="row">
                            <div class="mb-3 col-md-6">
                                {{ form.situacion_habitacional_hist.label_tag }}
                                {% render_field form.situacion_habitacional_hist class="form-control" %}
                            </div>
                            <div class="mb-3 col-md-6">
                                {{ form.observaciones.label_tag }}
                                {% render_field form.observaciones class="form-control" %}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card p-3 mb-3 shadow-sm">
                    <h6 class="mb-3">Documentos</h6>
                    {{ documento_formset.management_form }}
                    <div class="row">
                        {% for doc_form in documento_formset %}
                            <div class="col-md-6 mb-3">
                                <div class="border rounded p-2 shadow-sm">
                                    {{ doc_form.as_p }}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="card-footer bg-white border-0">
                    <div class="d-flex justify-content-end">
                        <a href="#" class="btn btn-secondary me-4">Cancelar</a>
                        <button type="submit" class="btn btn-primary ms-3">Guardar</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock body %}
